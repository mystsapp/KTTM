@model KVCTPCTViewModel

@using Microsoft.AspNetCore.Http
@using Data.Utilities
@inject IHttpContextAccessor HttpContextAccessor

@{

    var user = HttpContextAccessor.HttpContext.Session.GetSingle<User>("loginUser");
}

<div class="pr-2 pl-2" style="overflow-x:auto; overflow-y:auto">
    <table class="table mytable text-nowrap text-sm" id="cTPhieuTbl">
        <thead>
            <tr class="table-info">

                <th># @*<button type="button" class="btn btn-outline-info btn-sm text-bold btn-block" id="btn_New_KVCTPCT" data-kvpctid="@Model.KVPCT.SoCT" title="Right click to full"><i class="fas fa-plus"></i></button>*@</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().DienGiaiP)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().SoXe)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().HTTC)</th> <!--?-->
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().SoTienNT)</th> <!--?-->
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().LoaiTien)</th> <!--NgoaiTe-->
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().TyGia)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().SoTien)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().TKNo)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().MaKhNo)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().TKCo)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().DienGiai)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().MaKhCo)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().Sgtcode)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().NoQuay)</th><!--?-->
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().CoQuay)</th><!--?-->
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().CardNumber)</th><!--?-->
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().SalesSlip)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().SoCTGoc)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().KyHieu)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().LoaiHDGoc)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().NgayCTGoc)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().MauSoHD)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().MsThue)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().VAT)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().DSKhongVAT)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().BoPhan)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().STT)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().TenKH)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().DiaChi)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().MatHang)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().DieuChinh)</th>

                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().LinkHDDT)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().MaTraCuu)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().TkTruyCap)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().Password)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().TamUng)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().LoaiThe)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().CardNumber)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().Id)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().NguoiTao)</th>
                <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().HoanUngTU)</th>
                @if (user.Username == "hongvt")
                {
                    <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().SoTU_DaTT)</th>
                    <th>@Html.DisplayNameFor(m => m.KVCTPTCs.FirstOrDefault().SoTT_DaTao)</th>

                }
            </tr>
        </thead>
        <tbody>
            @if (Model.KVCTPTCs != null)
            {
                @foreach (var item in Model.KVCTPTCs)
                { // SoTU_DaTT: da ketchuyen | SoTT_DaTao: da tao 1 TT nao do'
                    if (string.IsNullOrEmpty(item.SoTU_DaTT) && string.IsNullOrEmpty(item.SoTT_DaTao)) // chua TT (chua ketchuyen)
                    {
                        <tr class="ctphieu-cursor-pointer " @*data-sotudatt="@item.SoTT_DaTao"*@>

                            <td>
                                <div class="btn-group text-white" role="group">

                                    @if (string.IsNullOrEmpty(item.TamUng)) // chua them vao tamung
                                    {
                                        
                                        if(!string.IsNullOrEmpty(item.HoanUngTU) || user.Username != item.NguoiTao || !string.IsNullOrEmpty(item.KVPTC.Locker)) // da hoan ung va khoa
                                        {
                                            <button type="button" disabled class="border-0 bg-transparent"><i class="fas fa-edit"></i></button>
                                        }
                                        else
                                        {
                                            <a class="text-primary btnEditKVCTPCT" asp-action="Edit_KVCTPTC" asp-controller="KVCTPTCs" title="Cập nhật" asp-route-id="@item.Id" asp-route-page="@Model.Page"><i class="fas fa-edit"></i></a>
                                        }

                                        @*<span class="text-dark"> | </span>*@

                                        <!--<a class="text-success" title="Chi tiết" asp-action="Details" asp-route-id="item.Id"><i class="fas fa-list"></i></a>-->

                                        <span class="text-dark"> | </span>
                                        <span id="confirmDeleteSpan_@item.Id" style="display: none">

                                            <span class="text-dark ">Xoá?</span>
                                            <button type="button" class="btn btn-danger btn-xs btnXoaDong" data-kvptcid="@Model.KVPTC.Id" data-id="@item.Id">Yes</button>
                                            <button type="button" class="btn btn-primary btn-xs" onclick="confirmDelete('@item.Id', false)">No</button>
                                        </span>
                                        <span id="deleteSpan_@item.Id">

                                            @if (!string.IsNullOrEmpty(item.HoanUngTU) || user.Username != item.NguoiTao || !string.IsNullOrEmpty(item.KVPTC.Locker)) // da hoan ung va khoa
                                            {
                                                <button type="button" disabled class="border-0 bg-transparent"><i class="fas fa-trash-alt"></i></button>
                                            }
                                            else
                                            {
                                                <button type="button" data-id="@item.Id" class="text-danger border-0 bg-transparent btnXoa" title="Xoá" onclick="confirmDelete('@item.Id', true)"><i class="fas fa-trash-alt"></i></button>
                                            }
                                        </span>

                                    }
                                    else // khong được xoa khi da them ct vao tam ung
                                    {
                                        <button type="button" disabled class="border-0 bg-transparent"><i class="fas fa-edit"></i></button>
                                        <span class="text-dark"> | </span>
                                        <button type="button" disabled class=" border-0 bg-transparent btnXoa" title="Xoá"><i class="fas fa-trash-alt"></i></button>

                                    }
                                    <!-- hidden form khoiphuc-->
                                    <!--<form asp-action="KhoiPhucTour" method="post" id="frmKhoiPhucTour">
                                        <input type="hidden" id="hidTourId" name="id" />
                                        <input type="hidden" id="hidStrUrl" name="strUrl" value="Model.StrUrl" />
                                    </form>-->
                                </div>
                            </td>

                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.DienGiaiP)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.SoXe)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.HTTC)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.Raw(item.SoTienNT.Value.ToString("N0"))</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.LoaiTien)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TyGia)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.Raw(item.SoTien.Value.ToString("N0"))</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TKNo)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MaKhNo)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TKCo)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.DienGiai)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MaKhCo)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.Sgtcode)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.NoQuay)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.CoQuay)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.CardNumber)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.SalesSlip)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.SoCTGoc)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.KyHieu)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.LoaiHDGoc)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.Raw(item.NgayCTGoc.HasValue ? item.NgayCTGoc.Value.ToString("dd/MM/yyyy") : "")</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MauSoHD)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MsThue)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.VAT)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.Raw(item.DSKhongVAT.ToString("N0"))</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.BoPhan)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.STT)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TenKH)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.DiaChi)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MatHang)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.DieuChinh)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.LinkHDDT)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MaTraCuu)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TkTruyCap)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.Password)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TamUng)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.LoaiThe)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.CardNumber)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.Id)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.NguoiTao)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.HoanUngTU)</td>
                            @if (user.Username == "hongvt")
                            {
                                <td class="tdVal_KVCTPCT" data-id="@item.Id">@Html.DisplayFor(m => item.SoTU_DaTT)</td>
                                <td class="tdVal_KVCTPCT" data-id="@item.Id">@Html.DisplayFor(m => item.SoTU_DaTT)</td>

                            }
                        </tr>
                    }
                    else // da TT (ket chyen)
                    {
                        <tr class="ctphieu-cursor-pointer text-info">  <!-- data-sotudatt="item.SoTU_DaTT"-->

                            <td>
                                <div class="btn-group text-white" role="group">
                                    <button type="button" disabled class="border-0 bg-transparent"><i class="fas fa-edit"></i></button>
                                    <span class="text-dark"> | </span>
                                    <button type="button" disabled class=" border-0 bg-transparent btnXoa" title="Xoá"><i class="fas fa-trash-alt"></i></button>

                                    <!--if (string.IsNullOrEmpty(item.TamUng)) // có trong tamung
                                    {
                                        <a class="text-primary btnEditKVCTPCT" asp-action="Edit_KVCTPTC" asp-controller="KVCTPTCs" title="Cập nhật" asp-route-id="item.Id" asp-route-page="Model.Page"><i class="fas fa-edit"></i></a>-->
                                    @*<span class="text-dark"> | </span>*@

                                    <!--<a class="text-success" title="Chi tiết" asp-action="Details" asp-route-id="item.Id"><i class="fas fa-list"></i></a>-->
                                    <!--<span class="text-dark"> | </span>
                                        <span id="confirmDeleteSpan_item.Id" style="display: none">

                                            <span class="text-dark ">Xoá?</span>
                                            <button type="button" class="btn btn-danger btn-xs btnXoaDong" data-kvptcid="Model.KVPTC.Id" data-id="item.Id">Yes</button>
                                            <button type="button" class="btn btn-primary btn-xs" onclick="confirmDelete('item.Id', false)">No</button>
                                        </span>
                                        <span id="deleteSpan_item.Id">

                                            <button type="button" data-id="item.Id" class="text-danger border-0 bg-transparent btnXoa" title="Xoá" onclick="confirmDelete('item.Id', true)"><i class="fas fa-trash-alt"></i></button>
                                        </span>

                                    }
                                    else // khong được xoa khi da them ct vao tam ung
                                    {
                                        <button type="button" disabled class="border-0 bg-transparent"><i class="fas fa-edit"></i></button>
                                        <span class="text-dark"> | </span>
                                        <button type="button" disabled class=" border-0 bg-transparent btnXoa" title="Xoá"><i class="fas fa-trash-alt"></i></button>

                                    }-->
                                    <!-- hidden form khoiphuc-->
                                    <!--<form asp-action="KhoiPhucTour" method="post" id="frmKhoiPhucTour">
                                        <input type="hidden" id="hidTourId" name="id" />
                                        <input type="hidden" id="hidStrUrl" name="strUrl" value="Model.StrUrl" />
                                    </form>-->
                    </div>
                            </td>

                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.DienGiaiP)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.SoXe)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.HTTC)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.Raw(item.SoTienNT.Value.ToString("N0"))</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.LoaiTien)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TyGia)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.Raw(item.SoTien.Value.ToString("N0"))</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TKNo)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MaKhNo)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TKCo)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.DienGiai)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MaKhCo)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.Sgtcode)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.NoQuay)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.CoQuay)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.CardNumber)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.SalesSlip)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.SoCTGoc)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.KyHieu)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.LoaiHDGoc)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.Raw(item.NgayCTGoc.HasValue ? item.NgayCTGoc.Value.ToString("dd/MM/yyyy") : "")</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MauSoHD)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MsThue)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.VAT)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.Raw(item.DSKhongVAT.ToString("N0"))</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.BoPhan)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.STT)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TenKH)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.DiaChi)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MatHang)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.DieuChinh)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.LinkHDDT)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.MaTraCuu)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TkTruyCap)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.Password)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.TamUng)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.LoaiThe)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.CardNumber)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.Id)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.NguoiTao)</td>
                            <td class="tdVal_KVCTPCT" data-id="@item.Id" data-hoanungtu="@item.HoanUngTU">@Html.DisplayFor(m => item.HoanUngTU)</td>
                            @if (user.Username == "hongvt")
                            {
                                <td class="tdVal_KVCTPCT" data-id="@item.Id">@Html.DisplayFor(m => item.SoTU_DaTT)</td>
                                <td class="tdVal_KVCTPCT" data-id="@item.Id">@Html.DisplayFor(m => item.SoTT_DaTao)</td>

                            }
                        </tr>
                    }

                }
            }
        </tbody>
    </table>
</div>

<script src="~/js/Admin/Home/indexController.js"></script>
<script>

    function confirmDelete(uniqueId, isDeleteClicked) {

        var deleteSpan = 'deleteSpan_' + uniqueId;
        var confirmDeleteSpan = 'confirmDeleteSpan_' + uniqueId;

        if (isDeleteClicked) {
            $('#' + deleteSpan).hide();
            $('#' + confirmDeleteSpan).show();
        } else {
            $('#' + deleteSpan).show();
            $('#' + confirmDeleteSpan).hide();
        }
    }

    // btnXoaDong
    $('.btnXoaDong').off('click').on('click',function () {

        var page = @Model.Page;
        var kvptcId = '@Model.KVPTC.Id';

        id = $(this).data('id');

        var url = '/KVCTPTCs/Delete';
        $.post(url, { id: id }, function (response) {
            debugger
            if (response) {
                toastr.success('Xoá thành công', 'Xoá!');
                indexController.Load_KVCTPCTPartial(kvptcId, page);
            }
        });

    });
        // btnXoaDong

    // btnTamUng
    $('#btnTamUng').off('click').on('click', function () {

        var page = @Model.Page;
        var soCT = '@Model.KVPTC.SoCT';
        var maCn = '@Model.KVPTC.MaCn';
        var kVPTCId = '@Model.KVPTC.Id';

        // kiem tra xem phieuchi nay da co tamung nao chua
        var url = '/TamUngs/CheckTamUng_In_PhieuChi';
        $.post(url, { soCT: soCT, maCn: maCn }, function (response) {
            //console.log(response);
            if (response.status) {
                toastr.error(response.message, 'Thêm tạm ứng!');
                return false;
            }
            else {

                // thoa yeu cau: chua ton tai tamung
                bootbox.confirm("Bạn có muốn thêm vào <b> tạm ứng </b> không?", function (result) {
                    if (result) {

                        id = $('#hidTamUng').val(); // kVCTPTCId

                        var url = '/TamUngs/Create';
                        $.post(url, { id: id }, function (response) {
                            //console.log(response);
                            if (response.status) {
                                toastr.success('Thêm mới thành công', 'Thêm tạm ứng!');
                                indexController.Load_KVCTPCTPartial(kVPTCId, page);
                            }
                            else {
                                toastr.error(response.message, 'Thêm tạm ứng!')
                            }
                        });
                    }
                });
            }

        });

    })
    // btnTamUng

    //// ctphieu-cursor-pointer
    //var sotudatt = $('.ctphieu-cursor-pointer').data('sotudatt');
    ////console.log(sotudatt);
    //if (sotudatt !== null) {
    //    alert(sotudatt);
    //}

    //// ctphieu-cursor-pointer


</script>